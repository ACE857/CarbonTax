!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Delaunator=e()}(this,function(){"use strict";var t=Math.pow(2,-52),e=function(e){var l=1/0,f=1/0,v=-1/0,u=-1/0,d=e.length>>1,_=this.ids=new Uint32Array(d);if(d>0&&"number"!=typeof e[0])throw new Error("Expected coords to contain numbers.");this.coords=e;for(var g=0;g<d;g++){var p=e[2*g],x=e[2*g+1];p<l&&(l=p),x<f&&(f=x),p>v&&(v=p),x>u&&(u=x),_[g]=g}for(var c,y,w,b=(l+v)/2,z=(f+u)/2,k=1/0,m=0;m<d;m++){var E=r(b,z,e[2*m],e[2*m+1]);E<k&&(c=m,k=E)}var M=e[2*c],A=e[2*c+1];k=1/0;for(var L=0;L<d;L++)if(L!==c){var S=r(M,A,e[2*L],e[2*L+1]);S<k&&S>0&&(y=L,k=S)}for(var T=e[2*y],K=e[2*y+1],D=1/0,U=0;U<d;U++)if(U!==c&&U!==y){var j=n(M,A,T,K,e[2*U],e[2*U+1]);j<D&&(w=U,D=j)}var q=e[2*w],F=e[2*w+1];if(D===1/0)throw new Error("No Delaunay triangulation exists for this input.");if(i(M,A,T,K,q,F)){var I=y,N=T,B=K;y=w,T=q,K=F,w=I,q=N,F=B}var C=function(t,e,r,i,n,h){var a=r-t,s=i-e,o=n-t,l=h-e,f=a*a+s*s,v=o*o+l*l,u=a*l-s*o;return{x:t+.5*(l*f-s*v)/u,y:e+.5*(a*v-o*f)/u}}(M,A,T,K,q,F);this._cx=C.x,this._cy=C.y,function t(e,r,i,n,h,a){var l,f,v;if(n-i<=20)for(l=i+1;l<=n;l++){for(v=e[l],f=l-1;f>=i&&s(r,e[f],v,h,a)>0;)e[f+1]=e[f--];e[f+1]=v}else{var u=i+n>>1;for(f=n,o(e,u,l=i+1),s(r,e[i],e[n],h,a)>0&&o(e,i,n),s(r,e[l],e[n],h,a)>0&&o(e,l,n),s(r,e[i],e[l],h,a)>0&&o(e,i,l),v=e[l];;){do{l++}while(s(r,e[l],v,h,a)<0);do{f--}while(s(r,e[f],v,h,a)>0);if(f<l)break;o(e,l,f)}e[i+1]=e[f],e[f]=v,n-l+1>=f-i?(t(e,r,l,n,h,a),t(e,r,i,f-1,h,a)):(t(e,r,i,f-1,h,a),t(e,r,l,n,h,a))}}(_,e,0,_.length-1,C.x,C.y),this._hashSize=Math.ceil(Math.sqrt(d)),this._hash=new Array(this._hashSize);var G=this.hull=h(e,c);this._hashEdge(G),G.t=0,G=h(e,y,G),this._hashEdge(G),G.t=1,G=h(e,w,G),this._hashEdge(G),G.t=2;var H=2*d-5,J=this.triangles=new Uint32Array(3*H),O=this.halfedges=new Int32Array(3*H);this.trianglesLen=0,this._addTriangle(c,y,w,-1,-1,-1);for(var P=0,Q=void 0,R=void 0;P<_.length;P++){var V=_[P],W=e[2*V],X=e[2*V+1];if(!(P>0&&Math.abs(W-Q)<=t&&Math.abs(X-R)<=t)&&(Q=W,R=X,V!==c&&V!==y&&V!==w)){var Y=this._hashKey(W,X),Z=Y,$=void 0;do{$=this._hash[Z],Z=(Z+1)%this._hashSize}while((!$||$.removed)&&Z!==Y);for(G=$=$.prev;!i(W,X,G.x,G.y,G.next.x,G.next.y);)if((G=G.next)===$){G=null;break}if(G){var tt=G===$,et=this._addTriangle(G.i,V,G.next.i,-1,-1,G.t);G.t=et,(G=h(e,V,G)).t=this._legalize(et+2);for(var rt=G.next;i(W,X,rt.x,rt.y,rt.next.x,rt.next.y);)et=this._addTriangle(rt.i,V,rt.next.i,rt.prev.t,-1,rt.t),rt.prev.t=this._legalize(et+2),this.hull=a(rt),rt=rt.next;if(tt)for(rt=G.prev;i(W,X,rt.prev.x,rt.prev.y,rt.x,rt.y);)et=this._addTriangle(rt.prev.i,V,rt.i,-1,rt.t,rt.prev.t),this._legalize(et+2),rt.prev.t=et,this.hull=a(rt),rt=rt.prev;this._hashEdge(G),this._hashEdge(G.prev)}}}this.triangles=J.subarray(0,this.trianglesLen),this.halfedges=O.subarray(0,this.trianglesLen)};function r(t,e,r,i){var n=t-r,h=e-i;return n*n+h*h}function i(t,e,r,i,n,h){return(i-e)*(n-r)-(r-t)*(h-i)<0}function n(t,e,r,i,n,h){var a=r-t,s=i-e,o=n-t,l=h-e,f=a*a+s*s,v=o*o+l*l,u=a*l-s*o,d=.5*(l*f-s*v)/u,_=.5*(a*v-o*f)/u;return f&&v&&u&&d*d+_*_||1/0}function h(t,e,r){var i={i:e,x:t[2*e],y:t[2*e+1],t:0,prev:null,next:null,removed:!1};return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function a(t){return t.prev.next=t.next,t.next.prev=t.prev,t.removed=!0,t.prev}function s(t,e,i,n,h){return r(t[2*e],t[2*e+1],n,h)-r(t[2*i],t[2*i+1],n,h)||t[2*e]-t[2*i]||t[2*e+1]-t[2*i+1]}function o(t,e,r){var i=t[e];t[e]=t[r],t[r]=i}function l(t){return t[0]}function f(t){return t[1]}return e.from=function(t,r,i){r||(r=l),i||(i=f);for(var n=t.length,h=new Float64Array(2*n),a=0;a<n;a++){var s=t[a];h[2*a]=r(s),h[2*a+1]=i(s)}return new e(h)},e.prototype._hashEdge=function(t){this._hash[this._hashKey(t.x,t.y)]=t},e.prototype._hashKey=function(t,e){return Math.floor((r=t-this._cx,i=e-this._cy,n=r/(Math.abs(r)+Math.abs(i)),(i>0?3-n:1+n)/4*this._hashSize))%this._hashSize;var r,i,n},e.prototype._legalize=function(t){var e=this.triangles,r=this.coords,i=this.halfedges,n=i[t],h=t-t%3,a=n-n%3,s=h+(t+1)%3,o=h+(t+2)%3,l=a+(n+2)%3;if(-1===n)return o;var f,v,u,d,_,g,p,x,c,y,w,b,z,k,m,E,M=e[o],A=e[t],L=e[s],S=e[l];if(f=r[2*M],v=r[2*M+1],u=r[2*A],d=r[2*A+1],_=r[2*L],g=r[2*L+1],p=r[2*S],x=r[2*S+1],(c=f-p)*((b=d-x)*(E=(z=_-p)*z+(k=g-x)*k)-(m=(w=u-p)*w+b*b)*k)-(y=v-x)*(w*E-m*z)+(c*c+y*y)*(w*k-b*z)<0){e[t]=S,e[n]=M;var T=i[l];if(-1===T){var K=this.hull;do{if(K.t===l){K.t=t;break}K=K.next}while(K!==this.hull)}this._link(t,T),this._link(n,i[o]),this._link(o,l);var D=a+(n+1)%3;return this._legalize(t),this._legalize(D)}return o},e.prototype._link=function(t,e){this.halfedges[t]=e,-1!==e&&(this.halfedges[e]=t)},e.prototype._addTriangle=function(t,e,r,i,n,h){var a=this.trianglesLen;return this.triangles[a]=t,this.triangles[a+1]=e,this.triangles[a+2]=r,this._link(a,i),this._link(a+1,n),this._link(a+2,h),this.trianglesLen+=3,a},e});
